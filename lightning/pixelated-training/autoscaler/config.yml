# Wayfarer Autoscaler Configuration

# Prometheus connection
prometheus_url: "http://prometheus:9090"

# Services to monitor and scale
services:
  - wayfarer-primary
  - wayfarer-fallback

# Scaling thresholds
thresholds:
  # CPU usage percentage to trigger scaling
  cpu_scale_up: 80.0
  cpu_scale_down: 20.0
  
  # Memory usage percentage to trigger scaling
  memory_scale_up: 85.0
  memory_scale_down: 30.0
  
  # Response time in seconds to trigger scaling
  response_time_scale_up: 5.0
  response_time_scale_down: 1.0
  
  # Request rate per minute to trigger scaling
  request_rate_scale_up: 50.0
  request_rate_scale_down: 10.0
  
  # GPU memory usage percentage to trigger scaling
  gpu_memory_scale_up: 90.0
  gpu_memory_scale_down: 40.0

# Scaling behavior configuration
scaling:
  # Minimum and maximum number of instances
  min_instances: 1
  max_instances: 5
  
  # Cooldown periods (seconds) after scaling actions
  scale_up_cooldown: 300    # 5 minutes
  scale_down_cooldown: 600  # 10 minutes
  
  # How often to check metrics (seconds)
  check_interval: 60        # 1 minute
  
  # Number of consecutive checks before scaling
  consecutive_checks: 3

# Model-specific scaling rules
model_rules:
  # Primary model (checkpoint-300) - balanced scaling
  primary:
    priority: 1
    max_instances: 3
    preferred_gpu: 0
    
  # Fallback model (checkpoint-200) - aggressive scaling for speed
  fallback:
    priority: 2
    max_instances: 5
    preferred_gpu: 1
    scale_up_threshold_multiplier: 0.8  # Scale up earlier
    
  # Crisis model (checkpoint-350) - conservative scaling for quality
  crisis:
    priority: 3
    max_instances: 2
    preferred_gpu: 2
    scale_down_threshold_multiplier: 1.5  # Scale down later

# Advanced configuration
advanced:
  # Predictive scaling based on historical patterns
  enable_predictive_scaling: true
  prediction_window_minutes: 30
  
  # Smart routing weight adjustment
  enable_dynamic_routing: true
  routing_adjustment_threshold: 0.2
  
  # Resource optimization
  enable_gpu_sharing: false  # Experimental
  memory_optimization: true
  
  # Monitoring and alerting
  enable_slack_alerts: false
  slack_webhook_url: ""
  alert_thresholds:
    high_error_rate: 5.0  # percentage
    high_response_time: 10.0  # seconds
    low_availability: 95.0  # percentage